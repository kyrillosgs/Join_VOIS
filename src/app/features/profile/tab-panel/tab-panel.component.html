<br />
<p-tabView
  [scrollable]="true"
  (activeIndexChange)="changeStage($event)"
  *ngIf="dataService.selectedInterview"
  [activeIndex]="activeIndex"
>
  <p-tabPanel *ngFor="let tab of allStages" [header]="tab.optionLabel">
    <div class="row">
      <div class="col-12 mb-2">
        <p-tag
          *ngFor="let assignee of assignees; let i = index"
          icon="pi pi-at"
          value="{{ assignee.name }}"
          id="{{ i }}"
          (mouseover)="hoveredTag = i"
          (mouseleave)="hoveredTag = -1"
        >
          <i
            class="pi pi-times-circle"
            *ngIf="hoveredTag == i"
            (click)="confirmAssigneeRemoval($event, i)"
          ></i>
        </p-tag>
        <p-tag class="add-tag">
          <span #addAssignee>
            <i
              class="pi pi-check-circle"
              (click)="addAssigneeToInterview()"
              *ngIf="addingTag"
            ></i>
            <i
              class="pi pi-times-circle"
              (click)="addingTag = false; newTag = ''"
              *ngIf="addingTag"
            ></i>

            <p-cascadeSelect
              [(ngModel)]="newTag"
              [options]="allUsers"
              optionLabel="name"
              optionValue="id"
              optionGroupLabel="tname"
              [optionGroupChildren]="['users']"
              [style]="{ maxWidth: '70%' }"
              placeholder="Select an assignee"
              (keyup.enter)="addAssigneeToInterview()"
              (keyup.escape)="addingTag = false; newTag = ''"
              class="add-tag-input text-light p-inputtext-sm"
              *ngIf="addingTag"
            ></p-cascadeSelect>
            <button
              *ngIf="!addingTag"
              class="button icon p-0 p-button-secondary p-button-text text-light p-button-sm"
              title="Add tag"
              type="button"
              pButton
              (click)="addAssigneeClick()"
              icon="pi pi-plus"
            ></button>
          </span>
        </p-tag>
        <p-button
          label="Generate Questions"
          styleClass="p-button-rounded p-button-secondary"
          class="float-right"
        ></p-button>
      </div>
      <div class="col-12">
        <p-accordion>
          <p-accordionTab
            header="{{ topic.name }}"
            *ngFor="let topic of topics"
          >
            <div class="row">
              <p-table
                [value]="getTopicQuestions(topic.id)"
                [tableStyle]="{ 'min-width': '100%' }"
                class="col-9"
              >
                <ng-template pTemplate="header">
                  <tr>
                    <th>Question</th>
                    <th>Answer</th>
                    <th>Score</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-question>
                  <tr>
                    <td>{{ question.name }}</td>
                    <td>{{ question.answer }}</td>
                    <td>
                      <p-knob
                        [id]="'qscore' + question.id"
                        [valueColor]="getScoreColor(question.id, 'questions')"
                        [(ngModel)]="question.score"
                        valueTemplate="{value}%"
                        (onChange)="
                          confirmQuestionScoreChange($event, question.id)
                        "
                        [size]="50"
                      ></p-knob>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
              <div class="col-3">
                <label class="form-label">Topic Score:</label>
                <div class="text-center">
                  <p-knob
                    [size]="65"
                    [id]="'tscore' + topic.id"
                    [valueColor]="getScoreColor(topic.id, 'topics')"
                    [(ngModel)]="topic.score"
                    valueTemplate="{value}%"
                    (onChange)="confirmTopicScoreChange($event, topic.id)"
                  ></p-knob>
                </div>
                <span class="p-float-label">
                  <textarea
                    #notes
                    [id]="'topic-notes' + topic.id"
                    style="width: 100%"
                    rows="5"
                    [(ngModel)]="topic.note"
                    [disabled]="!editingNotes"
                    pInputTextarea
                  ></textarea>
                  <label [for]="'interview-notes' + topic.id">Notes:</label>
                  <p-button
                    icon="pi pi-pencil"
                    *ngIf="!editingNotes"
                    styleClass="p-button-sm p-button-rounded p-button-text p-button-raised"
                    [style]="{
                      position: 'absolute',
                      bottom: '7%',
                      left: '3%'
                    }"
                    (click)="editNotes()"
                  ></p-button>
                  <p-button
                    icon="pi pi-times"
                    *ngIf="editingNotes"
                    styleClass="p-button-sm p-button-rounded p-button-text p-button-raised p-button-danger"
                    [style]="{
                      position: 'absolute',
                      bottom: '7%',
                      left: '3%'
                    }"
                    (click)="editingNotes = false; revertNotes(topic.id)"
                  ></p-button>
                  <p-button
                    icon="pi pi-check"
                    *ngIf="editingNotes"
                    styleClass="p-button-sm p-button-rounded p-button-text p-button-raised p-button-success"
                    [style]="{
                      position: 'absolute',
                      bottom: '7%',
                      left: '30%'
                    }"
                    (click)="updateNotes(topic.id)"
                  ></p-button>
                </span>
              </div>
            </div>
          </p-accordionTab>
        </p-accordion>
      </div>
    </div>
  </p-tabPanel>
</p-tabView>

<p-confirmPopup [key]="'removeAssignee'"></p-confirmPopup>
